---
layout: post
title: "第一篇文章及UE环境配置"
date: 2025-09-17 10:00:00 +0800
categories: blog
---

仔细一想这些年来做过的东西都没留下什么实质性的痕迹，因此这次决定拿Jekyll来记录一下近一年来在《麦琪的花园》中碰到的一些好玩的问题。

首先就是整个开发环境的一些修复和修改。

# CMake

今年新来的同事配置环境的时候碰到过CMake报错，当时是让他们降级到3.X版本解决的，实际上只是Unlua内的lua的CMake版本要求太低了。

```CMake
cmake_minimum_required(VERSION 2.8)
```

在4.0版本CMake取消了对3.5版本之前的兼容，所有最低版本必须不低于3.5，正好4.0版本是在今年3月发布的（[release note](https://github.com/Kitware/CMake/releases/tag/v4.0.0)），于是新同事们如果下载的是4.X版本就会碰上无法编译的问题

某种意义上也是Unlua低维护状态的一个缩影（

# 5.3的一些小bug

众所周知UE有原生的源代码管理支持，尤其是在几个蓝图版本之间对比来对比去是个很实用的功能，不过如果直接在5.3用git插件的"Diff Against"系列操作首先是会直接报错。

好在有traceback，直接就能找到出错的地方：

```diff
--- a/Engine/Plugins/Developer/GitSourceControl/Source/GitSourceControl/Private/GitSourceControlState.cpp
+++ b/Engine/Plugins/Developer/GitSourceControl/Source/GitSourceControl/Private/GitSourceControlState.cpp
@@ -40,7 +40,7 @@ TSharedPtr<class ISourceControlRevision, ESPMode::ThreadSafe> FGitSourceControlS
 TSharedPtr<class ISourceControlRevision, ESPMode::ThreadSafe> FGitSourceControlState::FindHistoryRevision(const FString& InRevision) const
 {
        // short hash must be >= 7 characters to have a reasonable probability of finding the correct revision
-       if (!ensure(InRevision.Len() < 7))
+       if (!ensure(InRevision.Len() >= 7))
        {
                return nullptr;
        }
```

居然是打反了符号……巧的是这个typo在5.3发布后半个月就修好了（[Commit](https://github.com/EpicGames/UnrealEngine/commit/49715a763a2e0a053a0213a5c6ef6bf04798570a)），刚好没合并进5.3

但是修好之后"Diff Against"还是会有报错"Unable to load assets to diff. Content may no longer be supported?"，这次直接根据文本内容在4个地方打上断点，结果还是`FGitSourceControlState::FindHistoryRevision`的问题：git插件并没有FileHash保存。

修倒是可以手动修，不过我觉得这个时候还是先查查官方有没有修过更好，果然已经修过了（[Commit](https://github.com/EpicGames/UnrealEngine/commit/fb5ef60a0dc3a27e69b969c5e84bbae79c071101)），直接用官方的patch

```diff
--- a/Engine/Plugins/Developer/GitSourceControl/Source/GitSourceControl/Private/GitSourceControlState.cpp
+++ b/Engine/Plugins/Developer/GitSourceControl/Source/GitSourceControl/Private/GitSourceControlState.cpp

@@ -48,9 +48,9 @@ TSharedPtr<class ISourceControlRevision, ESPMode::ThreadSafe> FGitSourceControlS
        for(const auto& Revision : History)
        {
                // support for short hashes
-               const int32 Len = FMath::Min(Revision->FileHash.Len(), InRevision.Len());
+               const int32 Len = FMath::Min(Revision->CommitId.Len(), InRevision.Len());

-               if(Revision->FileHash.Left(Len) == InRevision.Left(Len))
+               if(Revision->CommitId.Left(Len) == InRevision.Left(Len))
                {
                        return Revision;
                }
```

现在想想作为一个引擎自带的插件，只需要拷出来一份改好扔到项目里作为项目插件就能替换掉了，并不需要编译一份引擎，当时居然没注意到。

不过公版引擎还是不太应该作为所有人的开发环境，应该自行编译一份引擎，方便给shipping包加上log/trace去定位一些只有shipping包才会出现的问题或提供最接近shipping环境的trace。